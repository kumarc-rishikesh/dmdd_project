CREATE OR REPLACE TRIGGER before_sr_insert
BEFORE INSERT ON SERVICE_REQUEST
FOR EACH ROW
DECLARE
    V_RANDOM_EMPLOYEE_NAME VARCHAR2(50);
BEGIN
    SELECT EMPLOYEE_NAME
    INTO V_RANDOM_EMPLOYEE_NAME
    FROM EMPLOYEE
    WHERE DEPARTMENT_DEPT_ID = (
        SELECT DEPT_ID
        FROM DEPARTMENT
        WHERE NAME = :NEW.TYPE
    )
    ORDER BY DBMS_RANDOM.VALUE
    FETCH FIRST 1 ROW ONLY;

    IF V_RANDOM_EMPLOYEE_NAME IS NOT NULL THEN
        :NEW.STATUS := UPPER('Assigned to ' || V_RANDOM_EMPLOYEE_NAME);
    ELSE
        :NEW.STATUS := 'Not Assigned (No Employee in Department)';
    END IF;
END before_sr_insert;
/
